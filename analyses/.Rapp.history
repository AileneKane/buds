=256/2
256/2
254/2
255/2
254/2
# Where were the non-leafout cuttings, by species, site, and treatement?#
library(scales)#
<<<<<<< Updated upstream#
library(gplots) # for textplot()#
=======#
library(gplots)#
>>>>>>> Stashed changes#
#
setwd("~/Documents/git/buds/analyses") # setwd("~/Documents/git/projects/treegarden/budburstexp2015/analyses")
# Where were the non-leafout cuttings, by species, site, and treatement?#
library(scales)#
library(gplots) # for textplot()#
#
setwd("~/Documents/git/buds/analyses") # setwd("~/Documents/git/projects/treegarden/budburstexp2015/analyses")
# get latest data#
print(toload <- sort(dir("./input")[grep("Budburst Data", dir('./input'))], T)[1])
load(file.path("input", toload))
source("source/simpleplot.R")
dx <- dx[!is.na(dx$site),] # one Betpap entry has no site, need to check
# Analysis of where the non-leafout cuttings were#
nlx <- dx[dx$nl == 0,]
summary(nlx)#
#
nl1 <- as.data.frame(table(nlx$sp, nlx$site))#
#
nl2 <- as.data.frame(table(nlx$warm, nlx$photo, nlx$chill))#
# proportional to total numbers in each#
dl2 <- as.data.frame(table(dx$warm, dx$photo, dx$chill))#
nl2$prop <- nl2$Freq/dl2$Freq#
nl3 <- as.data.frame(table(nlx$sp, nlx$site,nlx$warm, nlx$photo, nlx$chill))#
dl3 <- as.data.frame(table(dx$sp, dx$site, dx$warm, dx$photo, dx$chill))#
nl3$prop <- nl3$Freq/dl3$Freq#
nl3$prop[is.nan(nl3$prop)==TRUE] <- 0#
names(nl1) <- c("sp","site","freq")#
names(nl2) <- c("warm","photo","chill","freq", "prop")#
names(nl3) <- c("sp", "site", "warm","photo","chill","freq", "prop")#
#
nl3.nochill <- subset(nl3, chill=="chill0")#
nl3.1chill <- subset(nl3, chill=="chill1")#
nl3.2chill <- subset(nl3, chill=="chill2")#
#
# make some simple plots#
makesimpleplot(nl3, c(0, 0.4), "prop", "% non-leafout") # all chilling combined#
makesimpleplot(nl3.nochill, c(0, 0.4), "prop", "% non-leafout")#
makesimpleplot(nl3.1chill, c(0, 0.4), "prop", "% non-leafout")#
makesimpleplot(nl3.2chill, c(0, 0.4), "prop", "% non-leafout")#
#
sitespp <- as.data.frame(table(nl3$sp, nl3$site))#
sitespp <- subset(sitespp, Freq>0)#
sppatsites <- aggregate(sitespp["Var2"], sitespp["Var1"], FUN=length)#
sppatbothsites <- subset(sppatsites, Var2>1)#
#
spp <- sppatbothsites$Var1#
pdf(file="graphs/simpleplots/nonleafouts_byspp.pdf", 10, 6, paper="a4r", onefile=TRUE)#
for (i in c(1:length(spp))){#
    spdf <- subset(nl3.nochill, sp==spp[i])#
    makesimpleplot.sp(spdf, c(0, 1), "prop", "% non-leafout", spp[i])#
}#
dev.off()
pdf(file="graphs/simpleplots/nonleafouts_byspp_model.pdf", height = 10, width = 10)#
#
par(cex=0.7, xpd=TRUE, xaxt="n")#
layout(matrix(c(1, 2, 3, 3), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
#
	makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)#
#
	# is this species across site and chill?#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) > 1)  {#
			mx <- glm(nl ~ warm + photo + chill + site #
							+ warm:photo + warm:chill + warm:site #
							+ photo:chill + photo:site#
							+ warm:photo:chill#
							+ warm:photo:site #
							+ warm:chill:site #
							+ photo:chill:site#
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
#
			} #
	# Across site but no chill?		#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1)  {#
			mx <- glm(nl ~ warm + photo + site #
							+ warm:photo +  warm:site + photo:site#
							+ warm:photo:site #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
			} #
	# One site, no chill?		#
	if(length(unique(dx[dx$sp ==i,"site"])) == 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1)  {#
		mx <- glm(nl ~ warm + photo +  #
							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
			} #
	mx <- glm(nl ~ warm + photo + chill + site +#
							warm:photo + warm:chill + warm:site +#
							 photo:chill + photo:site#
							  + site:chill#
							  + warm:photo:chill#
#							  + warm:photo:site#
#							  + warm:chill:site  #
#							  + photo:chill:site#
							  ,#
			family=binomial(link='logit'), #
			data = dx[dx$sp == i,]#
			)#
	textplot(round(coef(summary(mx)),3))#
		}#
dev.off(); system('open graphs/simpleplots/nonleafouts_byspp_model.pdf -a /Applications/Preview.app')
pdf(file="graphs/simpleplots/nonleafouts_byspp_model.pdf", height = 10, width = 10)#
#
par(cex=0.7, xpd=TRUE, xaxt="n")#
layout(matrix(c(1, 2, 3, 3), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
#
	makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)#
#
	# is this species across site and chill?#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) > 1)  {#
			mx <- glm(nl ~ warm + photo + chill + site #
							+ warm:photo + warm:chill + warm:site #
							+ photo:chill + photo:site#
							+ warm:photo:chill#
							+ warm:photo:site #
							+ warm:chill:site #
							+ photo:chill:site#
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
#
			} #
	# Across site but no chill?		#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1)  {#
			mx <- glm(nl ~ warm + photo + site #
							+ warm:photo +  warm:site + photo:site#
							+ warm:photo:site #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
			} #
	# One site, no chill?		#
	if(length(unique(dx[dx$sp ==i,"site"])) == 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1)  {#
		mx <- glm(nl ~ warm + photo +  #
							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
			} #
	textplot(round(coef(summary(mx)),3))#
		}#
dev.off(); system('open graphs/simpleplots/nonleafouts_byspp_model.pdf -a /Applications/Preview.app')
i="ACERUB"
length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) > 1
mx <- glm(nl ~ warm + photo + chill + site #
							+ warm:photo + warm:chill + warm:site #
							+ photo:chill + photo:site#
							+ warm:photo:chill#
							+ warm:photo:site #
							+ warm:chill:site #
							+ photo:chill:site#
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)
mx
i="ACEPEN"
mx <- glm(nl ~ warm + photo + chill + site #
							+ warm:photo + warm:chill + warm:site #
							+ photo:chill + photo:site#
							+ warm:photo:chill#
							+ warm:photo:site #
							+ warm:chill:site #
							+ photo:chill:site#
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)
mx
summary(mx)
# colors for plotting#
cols = alpha(c("darkseagreen", "deepskyblue", "slateblue"), 0.5)
bb <- barplot(nl2$prop*100, ylab = "% of cuttings non-leafout", #
	ylim = c(0,50), #
	col = rep(cols, each = 4),#
	main = "Percent of cuttings in each treatment which failed to leaf out",#
	xlab = "Treatment combination", sub = "(temp + photo + chill)")#
mtext(paste(nl2$warm, nl2$photo, nl2$chill, sep = "\n"), 1, line = -2, padj = 0, at = bb[,1])
sort(unique(dx$sp))
data.frame(sort(unique(dx$sp)))
par(cex=0.7, xpd=TRUE, xaxt="n")
layout(matrix(c(1, 2, 3, 3), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))
makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)
# Repeat, with simple model for all#
pdf(file="graphs/simpleplots/nonleafouts_byspp_simplemodel.pdf", height = 10, width = 10)#
#
par(cex=0.7, xpd=TRUE, xaxt="n")#
layout(matrix(c(1, 2, 3, 3), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
#
	makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)#
#
		mx <- glm(nl ~ warm + photo +  #
							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
  	textplot(round(coef(summary(mx)),3))#
	}#
dev.off(); system('open graphs/simpleplots/nonleafouts_byspp_simplemodel.pdf -a /Applications/Preview.app')
with(dx, interaction.plot(warm, photo, nl))
with(dx[dx$sp == i,], interaction.plot(warm, photo, nl))
pdf(file="graphs/simpleplots/nonleafouts_byspp_simplemodel.pdf", height = 10, width = 10)#
#
par(cex=0.7, xpd=TRUE, xaxt="n")#
layout(matrix(c(1, 2, 3, 3), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
#
	with(dx[dx$sp == i,], interaction.plot(warm, photo, nl))#
#
		mx <- glm(nl ~ warm + photo +  #
							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
  	textplot(round(coef(summary(mx)),3))#
	}#
dev.off(); system('open graphs/simpleplots/nonleafouts_byspp_simplemodel.pdf -a /Applications/Preview.app')
coef(summary(mx))
coef(summary(mx))[,4]
coef(summary(mx))[4,4]
# Repeat, with simple model for all#
pdf(file="graphs/simpleplots/nonleafouts_byspp_simplemodel.pdf", height = 10, width = 10)#
#
par(cex=0.7, xpd=TRUE, xaxt="n")#
layout(matrix(c(1, 2, 3, 4), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
#
	makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)#
		mx <- glm(nl ~ warm + photo +  #
							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
  	textplot(round(coef(summary(mx)),3))#
	if(coef(summary(mx))[4,4] <= 0.05){#
	with(dx[dx$sp == i,], interaction.plot(warm, photo, nl)) #
	} else { plot(1:10, type = "n", bty = "n", yaxt="n", xaxt="n",ylab="n",xlab="n")#
	}#
dev.off(); system('open graphs/simpleplots/nonleafouts_byspp_simplemodel.pdf -a /Applications/Preview.app')
}
# Repeat, with simple model for all#
pdf(file="graphs/simpleplots/nonleafouts_byspp_simplemodel.pdf", height = 10, width = 10)#
#
par(cex=0.7, xpd=TRUE, xaxt="n")#
layout(matrix(c(1, 2, 3, 4), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
#
	makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)#
		mx <- glm(nl ~ warm + photo +  #
							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
  	textplot(round(coef(summary(mx)),3))#
	if(coef(summary(mx))[4,4] <= 0.05){#
	with(dx[dx$sp == i,], interaction.plot(warm, photo, nl)) #
	} else { plot(1:10, type = "n", bty = "n", yaxt="n", xaxt="n",ylab="n",xlab="n") }#
	}#
dev.off(); system('open graphs/simpleplots/nonleafouts_byspp_simplemodel.pdf -a /Applications/Preview.app')
i="AROMEL"
makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)
mx <- glm(nl ~ warm + photo +  #
							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)
dx[dx$sp == i,]
mx <- glm(nl ~ warm + photo +  #
							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)
mx
i
dx$warm <- as.numeric(as.character(dx$warm))#
dx$photo <- as.numeric(as.character(dx$photo))
mx <- glm(nl ~ warm + photo +  #
							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)
mx
textplot(round(coef(summary(mx)),3))
mx <- glm(nl ~ warm + photo  #
							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)
mx
mx <- glm(nl ~ warm + photo  #
#							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)
mx
textplot(round(coef(summary(mx)),3))
mx <- glm(nl ~ warm + photo  #
#							+ warm:photo #
							, data = dx[dx$sp == i,]#
							)
mx
summary(mx)
mx <- lm(nl ~ warm + photo  #
#							+ warm:photo #
							, data = dx[dx$sp == i,]#
							)
mx
mx <- aov(nl ~ warm + photo  #
#							+ warm:photo #
							, data = dx[dx$sp == i,]#
							)
mx
dx[dx$sp==i,]
summary(dx[dx$sp==i,])
summary(dx[dx$sp==i,]$warm)
table(dx[dx$sp==i,]$warm)
table(dx[dx$sp==i,]$photo)
table(dx[dx$sp==i,]$photo, dx[dx$sp==i,]$warm)
dev.off(); system('open graphs/simpleplots/nonleafouts_byspp_model.pdf -a /Applications/Preview.app')#
# Repeat, with simple model for all. Aronia: 1 nl occured in each of the four combinations of photo and warm, no separation.#
dx$warm <- as.numeric(as.character(dx$warm))#
dx$photo <- as.numeric(as.character(dx$photo))#
#
pdf(file="graphs/simpleplots/nonleafouts_byspp_simplemodel.pdf", height = 10, width = 10)#
#
par(cex=0.7, xpd=TRUE, xaxt="n")#
layout(matrix(c(1, 2, 3, 4), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
#
	makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)#
		mx <- glm(nl ~ warm + photo  #
							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
  	textplot(round(coef(summary(mx)),3))#
	if(coef(summary(mx))[4,4] <= 0.05){#
	with(dx[dx$sp == i,], interaction.plot(warm, photo, nl)) #
	} else { plot(1:10, type = "n", bty = "n", yaxt="n", xaxt="n",ylab="n",xlab="n") }#
	}#
dev.off(); system('open graphs/simpleplots/nonleafouts_byspp_simplemodel.pdf -a /Applications/Preview.app')
pdf(file="graphs/simpleplots/nonleafouts_byspp_simplemodel.pdf", height = 10, width = 10)#
#
par(cex=0.7, xpd=TRUE, xaxt="n")#
layout(matrix(c(1, 2, 3, 4), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
#
	makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)#
		mx <- glm(nl ~ warm + photo  #
							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
  	textplot(round(coef(summary(mx)),3))#
	if(coef(summary(mx))[4,4] <= 0.05){#
	with(dx[dx$sp == i,], interaction.plot(warm, photo, nl)) #
	} else { plot(1:10, type = "n", bty = "n", yaxt="n", xaxt="n",ylab="n",xlab="n") }#
	}#
dev.off(); system('open graphs/simpleplots/nonleafouts_byspp_simplemodel.pdf -a /Applications/Preview.app')
pdf(file="graphs/simpleplots/nonleafouts_byspp_model.pdf", height = 10, width = 10)#
#
par(cex=0.7, xpd=TRUE, xaxt="n")#
layout(matrix(c(1, 2, 3, 3), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
#
	makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)#
#
	# is this species across site and chill?#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) > 1)  {#
			mx <- glm(nl ~ warm + photo + chill + site #
							+ warm:photo + warm:chill + warm:site #
							+ photo:chill + photo:site#
							+ warm:photo:chill#
							+ warm:photo:site #
							+ warm:chill:site #
							+ photo:chill:site#
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
#
			} #
	# Across site but no chill?		#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1)  {#
			mx <- glm(nl ~ warm + photo + site #
							+ warm:photo +  warm:site + photo:site#
							+ warm:photo:site #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
			} #
	# One site, no chill?		#
	if(length(unique(dx[dx$sp ==i,"site"])) == 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1)  {#
		mx <- glm(nl ~ warm + photo +  #
							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
			} #
	textplot(round(coef(summary(mx)),3))#
		}#
dev.off(); system('open graphs/simpleplots/nonleafouts_byspp_model.pdf -a /Applications/Preview.app')
makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)
makesimpleplot.sp
pdf(file="graphs/simpleplots/nonleafouts_sitechill.pdf", height = 10, width = 10)#
#
par(cex=0.7, xpd=TRUE, xaxt="n")#
layout(matrix(c(1, 2, 3, 3), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
	# is this species across site and chill?#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) > 1)  {#
			makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)#
#
			mx <- glm(nl ~ chill * site #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
#
	textplot(round(coef(summary(mx)),3))#
#
			} 		#
		}#
dev.off(); system('open graphs/simpleplots/nonleafouts_sitechill.pdf -a /Applications/Preview.app')
as.character(dx$chill)
as.numeric(as.character(dx$chill))
as.numeric(dx$chill)
dx$chill <- as.numeric(dx$chill)
pdf(file="graphs/simpleplots/nonleafouts_sitechill.pdf", height = 10, width = 10)#
#
par(cex=0.7, xpd=TRUE, xaxt="n")#
layout(matrix(c(1, 2, 3, 3), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
	# is this species across site and chill?#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) > 1)  {#
			makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)#
#
			mx <- glm(nl ~ chill * site #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
#
	textplot(round(coef(summary(mx)),3))#
#
			} 		#
		}#
dev.off(); system('open graphs/simpleplots/nonleafouts_sitechill.pdf -a /Applications/Preview.app')
dx$chill <- as.numeric(dx$chill)#
#
pdf(file="graphs/simpleplots/nonleafouts_byspp_model.pdf", height = 10, width = 10)#
#
par(cex=0.7, xpd=TRUE, xaxt="n")#
layout(matrix(c(1, 2, 3, 3), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
#
	makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)#
#
	# is this species across site and chill?#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) > 1)  {#
			mx <- glm(nl ~ warm + photo + chill + site #
							+ warm:photo + warm:chill + warm:site #
							+ photo:chill + photo:site#
							+ warm:photo:chill#
							+ warm:photo:site #
							+ warm:chill:site #
							+ photo:chill:site#
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
#
			} #
	# Across site but no chill?		#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1)  {#
			mx <- glm(nl ~ warm + photo + site #
							+ warm:photo +  warm:site + photo:site#
							+ warm:photo:site #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
			} #
	# One site, no chill?		#
	if(length(unique(dx[dx$sp ==i,"site"])) == 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1)  {#
		mx <- glm(nl ~ warm + photo +  #
							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
			} #
	textplot(round(coef(summary(mx)),3))#
		}#
dev.off(); system('open graphs/simpleplots/nonleafouts_byspp_model.pdf -a /Applications/Preview.app')
summary.aov(mx)
mx
summary(mx)
anova(mx)
dx$site <- as.numeric(dx$site)
pdf(file="graphs/simpleplots/nonleafouts_byspp_model.pdf", height = 10, width = 10)#
#
par(cex=0.7, xpd=TRUE, xaxt="n")#
layout(matrix(c(1, 2, 3, 3), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
#
	makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)#
#
	# is this species across site and chill?#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) > 1)  {#
			mx <- glm(nl ~ warm + photo + chill + site #
							+ warm:photo + warm:chill + warm:site #
							+ photo:chill + photo:site#
							+ warm:photo:chill#
							+ warm:photo:site #
							+ warm:chill:site #
							+ photo:chill:site#
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
#
			} #
	# Across site but no chill?		#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1)  {#
			mx <- glm(nl ~ warm + photo + site #
							+ warm:photo +  warm:site + photo:site#
							+ warm:photo:site #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
			} #
	# One site, no chill?		#
	if(length(unique(dx[dx$sp ==i,"site"])) == 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1)  {#
		mx <- glm(nl ~ warm + photo +  #
							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
			} #
	textplot(round(coef(summary.aov(mx)),3))#
		}#
dev.off(); system('open graphs/simpleplots/nonleafouts_byspp_model.pdf -a /Applications/Preview.app')
# Tally sig site * chill effects#
dx$chill <- as.numeric(dx$chill)#
dx$site <- as.numeric(dx$site)#
#
pdf(file="graphs/simpleplots/nonleafouts_byspp_model.pdf", height = 10, width = 10)#
#
par(cex=0.7, xpd=TRUE, xaxt="n")#
layout(matrix(c(1, 2, 3, 3), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
#
	makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)#
#
	# is this species across site and chill?#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) > 1)  {#
			mx <- glm(nl ~ warm + photo + chill + site #
							+ warm:photo + warm:chill + warm:site #
							+ photo:chill + photo:site#
							+ warm:photo:chill#
							+ warm:photo:site #
							+ warm:chill:site #
							+ photo:chill:site#
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
#
			} #
	# Across site but no chill?		#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1)  {#
			mx <- glm(nl ~ warm + photo + site #
							+ warm:photo +  warm:site + photo:site#
							+ warm:photo:site #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
			} #
	# One site, no chill?		#
	if(length(unique(dx[dx$sp ==i,"site"])) == 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1)  {#
		mx <- glm(nl ~ warm + photo +  #
							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
			} #
	textplot(round(coef(summary.aov(mx)),3))#
		}#
dev.off(); system('open graphs/simpleplots/nonleafouts_byspp_model.pdf -a /Applications/Preview.app')
as.numeric(dx$site)
par(cex=0.7, xpd=TRUE, xaxt="n")#
layout(matrix(c(1, 2, 3, 3), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))
makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)
# is this species across site and chill?#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) > 1)  {#
			mx <- glm(nl ~ warm + photo + chill + site #
							+ warm:photo + warm:chill + warm:site #
							+ photo:chill + photo:site#
							+ warm:photo:chill#
							+ warm:photo:site #
							+ warm:chill:site #
							+ photo:chill:site#
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
#
			}
length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1
length(unique(dx[dx$sp ==i,"site"])) == 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1
textplot(round(coef(summary.aov(mx)),3))
textplot(round(coef(summary(mx)),3))
# Tally sig site * chill effects#
dx$chill <- as.numeric(dx$chill)#
dx$site <- as.numeric(dx$site)#
#
pdf(file="graphs/simpleplots/nonleafouts_byspp_model.pdf", height = 10, width = 10)#
#
par(cex=0.7, xpd=TRUE, xaxt="n")#
layout(matrix(c(1, 2, 3, 3), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
#
	makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)#
#
	# is this species across site and chill?#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) > 1)  {#
			mx <- glm(nl ~ warm + photo + chill + site #
							+ warm:photo + warm:chill + warm:site #
							+ photo:chill + photo:site#
							+ warm:photo:chill#
							+ warm:photo:site #
							+ warm:chill:site #
							+ photo:chill:site#
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
#
			} #
	# Across site but no chill?		#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1)  {#
			mx <- glm(nl ~ warm + photo + site #
							+ warm:photo +  warm:site + photo:site#
							+ warm:photo:site #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
			} #
	# One site, no chill?		#
	if(length(unique(dx[dx$sp ==i,"site"])) == 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1)  {#
		mx <- glm(nl ~ warm + photo +  #
							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
			} #
	textplot(round(coef(summary(mx)),3))#
		}#
dev.off(); system('open graphs/simpleplots/nonleafouts_byspp_model.pdf -a /Applications/Preview.app')
pdf(file="graphs/simpleplots/nonleafouts_sitechill.pdf", height = 10, width = 10)#
#
par(cex=0.7, xpd=TRUE, xaxt="n")#
layout(matrix(c(1, 2, 3, 3), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
	# is this species across site and chill?#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) > 1)  {#
			makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)#
#
			mx <- glm(nl ~ chill * site #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
#
	textplot(round(coef(summary(mx)),3))#
#
			} 		#
		}#
dev.off(); system('open graphs/simpleplots/nonleafouts_sitechill.pdf -a /Applications/Preview.app')
dx[dx$sp ==i,
]
boxplot(nl ~ chill, data = dx[dx$sp==i,])
i
dx[dx$sp==i,]
dx[dx$sp==i,"nl"]
barplot(nl ~ chill, data = dx[dx$sp==i,])
boxplot(nl ~ chill, data = dx[dx$sp==i,])
dx$site
boxplot(nl ~ chill, data = dx[dx$sp==i & dx$site==1,])
with(xx, tapply(nl, list(chill, site), mean, na.rm=T)
)
xx <- dx[dx$sp==i,]
with(xx, tapply(nl, list(chill, site), mean, na.rm=T))
sds <- with(xx, tapply(nl, list(chill, site), sd, na.rm=T))
sds
means <- with(xx, tapply(nl, list(chill, site), mean, na.rm=T))
sds <- with(xx, tapply(nl, list(chill, site), sd, na.rm=T))
plot(means[,1])
plot(means[,1], ylim = c(0, 1))
arrows(1:3, means[,1]-sds[,1], 1:3, means[,1]+sds[,1])
plot(means[,1], ylim = c(0, 1), main = "HF")#
		arrows(1:3, means[,1]-sds[,1], 1:3, means[,1]+sds[,1], code = 1)
plot(means[,1], ylim = c(0, 1), main = "HF")#
		arrows(1:3, means[,1]-sds[,1], 1:3, means[,1]+sds[,1], code = 3)
plot(means[,1], ylim = c(0, 1), main = "HF", col = "black")#
		arrows(1:3, means[,1]-sds[,1], 1:3, means[,1]+sds[,1], length = 0)
plot(means[,1], ylim = c(0, 1), main = "HF", pch = 16)#
		arrows(1:3, means[,1]-sds[,1], 1:3, means[,1]+sds[,1], length = 0)
axis(1, 1:3, labels = c("chill0", "chill1","chill2"))
means <- with(xx, tapply(nl, list(chill, site), mean, na.rm=T))#
		sds <- with(xx, tapply(nl, list(chill, site), sd, na.rm=T))#
		axis(1, 1:3, labels = c("chill0", "chill1","chill2"))#
		plot(means[,1], ylim = c(0, 1), main = "HF", pch = 16)#
		arrows(1:3, means[,1]-sds[,1], 1:3, means[,1]+sds[,1], length = 0)
axis(1, 1:3, labels = c("chill0", "chill1","chill2"))
axis(1, at=1:3, labels = c("chill0", "chill1","chill2"))
plot(means[,1], ylim = c(0, 1), main = "HF", pch = 16, ylab = "prop leafout")#
		axis(1, at=1:3, labels = c("chill0", "chill1","chill2"))		#
		arrows(1:3, means[,1]-sds[,1], 1:3, means[,1]+sds[,1], length = 0)
axis(1, at=1:3, labels = c("chill0", "chill1","chill2"))
?axis
axis(1)
plot(means[,1], ylim = c(0, 1), main = "HF", pch = 16, ylab = "prop leafout")
axis(1, at=1:3, labels = c("chill0", "chill1","chill2"))
means[,1]
locator()
plot(1:3, means[,1], ylim = c(0, 1), main = "HF", pch = 16, ylab = "prop leafout")
axis(1, at=1:3, labels = c("chill0", "chill1","chill2"))
arrows(1:3, means[,1]-sds[,1], 1:3, means[,1]+sds[,1], length = 0)#
			mx <- glm(nl ~ chill * site #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)
locator()
axis(1, at=1:3, labels = c("chill0", "chill1","chill2"))
par(cex=0.7)
layout(matrix(c(1, 2, 3, 3), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))
xx <- dx[dx$sp==i,]#
		means <- with(xx, tapply(nl, list(chill, site), mean, na.rm=T))#
		sds <- with(xx, tapply(nl, list(chill, site), sd, na.rm=T))
plot(1:3, means[,1], ylim = c(0, 1), main = "HF", pch = 16, ylab = "prop leafout")#
		axis(1, at=1:3, labels = c("chill0", "chill1","chill2"))		#
		arrows(1:3, means[,1]-sds[,1], 1:3, means[,1]+sds[,1], length = 0)
plot(1:3, means[,1], ylim = c(0, 1), main = "HF", pch = 16, ylab = "prop leafout", xaxt="n")
axis(1, at=1:3, labels = c("chill0", "chill1","chill2"))
arrows(1:3, means[,1]-sds[,1], 1:3, means[,1]+sds[,1], length = 0)
plot(1:3, means[,1], ylim = c(0, 1.25), main = "HF", pch = 16, ylab = "prop leafout", xaxt="n")
axis(1, at=1:3, labels = c("chill0", "chill1","chill2"))
arrows(1:3, means[,1]-sds[,1], 1:3, means[,1]+sds[,1], length = 0)
mx <- glm(nl ~ chill * site #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)
mx
textplot(round(coef(summary(mx)),3))
coef(summary(mx))[4,4]
pdf(file="graphs/simpleplots/nonleafouts_sitechill.pdf", height = 10, width = 10)#
#
par(cex=0.7)#
layout(matrix(c(1, 2, 3, 4), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
	# is this species across site and chill?#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) > 1)  {#
		xx <- dx[dx$sp==i,]#
		means <- with(xx, tapply(nl, list(chill, site), mean, na.rm=T))#
		sds <- with(xx, tapply(nl, list(chill, site), sd, na.rm=T))#
#
		plot(1:3, means[,1], ylim = c(0, 1.25), main = "HF", pch = 16, ylab = "prop leafout", xaxt="n")#
		axis(1, at=1:3, labels = c("chill0", "chill1","chill2"))		#
		arrows(1:3, means[,1]-sds[,1], 1:3, means[,1]+sds[,1], length = 0)#
#
		plot(1:3, means[,2], ylim = c(0, 1.25), main = "SH", pch = 16, ylab = "prop leafout", xaxt="n")#
		axis(1, at=1:3, labels = c("chill0", "chill1","chill2"))		#
		arrows(1:3, means[,2]-sds[,2], 1:3, means[,2]+sds[,2], length = 0)#
			mx <- glm(nl ~ chill * site #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
#
		textplot(round(coef(summary(mx)),3))#
		if(coef(summary(mx))[4,4] <= 0.05){#
			with(dx[dx$sp == i,], interaction.plot(warm, photo, nl)) #
			} else { plot(1:10, type = "n", bty = "n", yaxt="n", xaxt="n",ylab="n",xlab="n") }#
		}#
		}#
dev.off(); system('open graphs/simpleplots/nonleafouts_sitechill.pdf -a /Applications/Preview.app')
# Repeat, with simple model for all. Aronia: 1 nl occured in each of the four combinations of photo and warm, no separation.#
dx$warm <- as.numeric(as.character(dx$warm))#
dx$photo <- as.numeric(as.character(dx$photo))#
#
pdf(file="graphs/simpleplots/nonleafouts_byspp_simplemodel.pdf", height = 10, width = 10)#
#
par(cex=0.7, xpd=TRUE, xaxt="n")#
layout(matrix(c(1, 2, 3, 4), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
#
	makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)#
		mx <- glm(nl ~ warm + photo  #
							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
  	textplot(round(coef(summary(mx)),3))#
	if(coef(summary(mx))[4,4] <= 0.05){#
	with(dx[dx$sp == i,], interaction.plot(warm, photo, nl)) #
	} else { plot(1:10, type = "n", bty = "n", yaxt="n", xaxt="n",ylab="",xlab="") }#
	}#
dev.off(); system('open graphs/simpleplots/nonleafouts_byspp_simplemodel.pdf -a /Applications/Preview.app')
# Focus on site x chill#
#
# Tally sig site * chill effects#
#
pdf(file="graphs/simpleplots/nonleafouts_sitechill.pdf", height = 10, width = 10)#
#
par(cex=0.7)#
layout(matrix(c(1, 2, 3, 4), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
	# is this species across site and chill?#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) > 1)  {#
		xx <- dx[dx$sp==i,]#
		means <- with(xx, tapply(nl, list(chill, site), mean, na.rm=T))#
		sds <- with(xx, tapply(nl, list(chill, site), sd, na.rm=T))#
#
		plot(1:3, means[,1], ylim = c(0, 1.25), main = "HF", pch = 16, ylab = "prop leafout", xaxt="n")#
		axis(1, at=1:3, labels = c("chill0", "chill1","chill2"))		#
		arrows(1:3, means[,1]-sds[,1], 1:3, means[,1]+sds[,1], length = 0)#
#
		plot(1:3, means[,2], ylim = c(0, 1.25), main = "SH", pch = 16, ylab = "prop leafout", xaxt="n")#
		axis(1, at=1:3, labels = c("chill0", "chill1","chill2"))		#
		arrows(1:3, means[,2]-sds[,2], 1:3, means[,2]+sds[,2], length = 0)#
			mx <- glm(nl ~ chill * site #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
#
		textplot(round(coef(summary(mx)),3))#
		if(coef(summary(mx))[4,4] <= 0.05){#
			with(dx[dx$sp == i,], interaction.plot(warm, photo, nl)) #
			} else { plot(1:10, type = "n", bty = "n", yaxt="n", xaxt="n",ylab="",xlab="") }#
		}#
		}#
dev.off(); system('open graphs/simpleplots/nonleafouts_sitechill.pdf -a /Applications/Preview.app')
pdf(file="graphs/simpleplots/nonleafouts_sitechill.pdf", height = 10, width = 10)#
#
par(cex=0.7)#
layout(matrix(c(1, 2, 3, 4), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
	# is this species across site and chill?#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) > 1)  {#
		xx <- dx[dx$sp==i,]#
		means <- with(xx, tapply(nl, list(chill, site), mean, na.rm=T))#
		sds <- with(xx, tapply(nl, list(chill, site), sd, na.rm=T))#
#
		plot(1:3, means[,1], ylim = c(0, 1.25), main = "HF", pch = 16, ylab = "prop leafout", xaxt="n")#
		axis(1, at=1:3, labels = c("chill0", "chill1","chill2"))		#
		arrows(1:3, means[,1]-sds[,1], 1:3, means[,1]+sds[,1], length = 0)#
#
		plot(1:3, means[,2], ylim = c(0, 1.25), main = "SH", pch = 16, ylab = "prop leafout", xaxt="n")#
		axis(1, at=1:3, labels = c("chill0", "chill1","chill2"))		#
		arrows(1:3, means[,2]-sds[,2], 1:3, means[,2]+sds[,2], length = 0)#
			mx <- glm(nl ~ chill * site #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
#
		textplot(round(coef(summary(mx)),3))#
		if(coef(summary(mx))[4,4] <= 0.05){#
			with(dx[dx$sp == i,], interaction.plot(chill, site, nl)) #
			} else { plot(1:10, type = "n", bty = "n", yaxt="n", xaxt="n",ylab="",xlab="") }#
		}#
		}#
dev.off(); system('open graphs/simpleplots/nonleafouts_sitechill.pdf -a /Applications/Preview.app')
pdf(file="graphs/simpleplots/nonleafouts_sitechill.pdf", height = 10, width = 10)#
#
par(cex=0.7)#
layout(matrix(c(1, 2, 3, 4), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
	# is this species across site and chill?#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) > 1)  {#
		xx <- dx[dx$sp==i,]#
		means <- with(xx, tapply(nl, list(chill, site), mean, na.rm=T))#
		sds <- with(xx, tapply(nl, list(chill, site), sd, na.rm=T))#
#
		plot(1:3, means[,1], ylim = c(0, 1.25), main = paste(i, "HF"), pch = 16, ylab = "prop leafout", xaxt="n")#
		axis(1, at=1:3, labels = c("chill0", "chill1","chill2"))		#
		arrows(1:3, means[,1]-sds[,1], 1:3, means[,1]+sds[,1], length = 0)#
#
		plot(1:3, means[,2], ylim = c(0, 1.25), main = "SH", pch = 16, ylab = "prop leafout", xaxt="n")#
		axis(1, at=1:3, labels = c("chill0", "chill1","chill2"))		#
		arrows(1:3, means[,2]-sds[,2], 1:3, means[,2]+sds[,2], length = 0)#
			mx <- glm(nl ~ chill * site #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
#
		textplot(round(coef(summary(mx)),3))#
		if(coef(summary(mx))[4,4] <= 0.05){#
			with(dx[dx$sp == i,], interaction.plot(chill, site, nl)) #
			} else { plot(1:10, type = "n", bty = "n", yaxt="n", xaxt="n",ylab="",xlab="") }#
		}#
		}#
dev.off(); system('open graphs/simpleplots/nonleafouts_sitechill.pdf -a /Applications/Preview.app')
i="ILEMUC"
# is this species across site and chill?#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) > 1)  {#
			mx <- glm(nl ~ warm + photo + chill + site #
							+ warm:photo + warm:chill + warm:site #
							+ photo:chill + photo:site#
							+ warm:photo:chill#
							+ warm:photo:site #
							+ warm:chill:site #
							+ photo:chill:site#
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
#
			}
mx
dx[dx$sp == i,]
witable(dx[dx$sp == i,"warm"]
with(dx[dx$sp == i,], table(warm, photo, site, chill))
with(dx[dx$sp == i,], tapply(nl, list(warm, photo, site, chill), mean))
m1 <- glm(nl ~ warm + photo + chill + site #
							+ warm:photo + warm:chill + warm:site #
							+ photo:chill + photo:site#
							+ warm:photo:chill#
							+ warm:photo:site #
							+ warm:chill:site #
							+ photo:chill:site#
							, family=binomial(link='logit'), data = dx#
							)
summary(m1)
library(lme4)
m2 <- glmer(nl ~ warm + photo + chill + site #
							+ warm:photo + warm:chill + warm:site #
							+ photo:chill + photo:site#
							+ warm:photo:chill#
							+ warm:photo:site #
							+ warm:chill:site #
							+ photo:chill:site#
							+ (1|sp),#
							, family=binomial(link='logit'), data = dx#
							)
m2
summary(m2)
head(dx)
??sjplot
librayr(sjPlot)
library(sjPlot)
sjp.glmer(m2)
sjp.glmer(m2, type = "fe")
setwd("~/Documents/git/buds/analyses") # setwd("~/Documents/git/projects/treegarden/budburstexp2015/analyses")#
#
# get latest data#
print(toload <- sort(dir("./input")[grep("Budburst Data", dir('./input'))], T)[1])#
#
load(file.path("input", toload))#
#
source("source/simpleplot.R")#
#
dx <- dx[!is.na(dx$site),] # one Betpap entry has no site, need to check#
#
# Analysis of where the non-leafout cuttings were#
nlx <- dx[dx$nl == 0,]#
#
summary(nlx)
dx$chill <- as.numeric(dx$chill)#
dx$site <- as.numeric(dx$site)#
dx$photo <- as.numeric(as.character(dx$photo))#
dx$warm <- as.numeric(as.character(dx$warm))
# Where were the non-leafout cuttings, by species, site, and treatement?#
library(scales)#
library(gplots) # for textplot()#
#
setwd("~/Documents/git/buds/analyses") # setwd("~/Documents/git/projects/treegarden/budburstexp2015/analyses")#
#
# get latest data#
print(toload <- sort(dir("./input")[grep("Budburst Data", dir('./input'))], T)[1])#
#
load(file.path("input", toload))#
#
source("source/simpleplot.R")#
#
dx <- dx[!is.na(dx$site),] # one Betpap entry has no site, need to check#
#
# Analysis of where the non-leafout cuttings were#
nlx <- dx[dx$nl == 0,]#
#
summary(nlx)#
#
nl1 <- as.data.frame(table(nlx$sp, nlx$site))#
#
nl2 <- as.data.frame(table(nlx$warm, nlx$photo, nlx$chill))#
# proportional to total numbers in each#
dl2 <- as.data.frame(table(dx$warm, dx$photo, dx$chill))#
nl2$prop <- nl2$Freq/dl2$Freq#
nl3 <- as.data.frame(table(nlx$sp, nlx$site,nlx$warm, nlx$photo, nlx$chill))#
dl3 <- as.data.frame(table(dx$sp, dx$site, dx$warm, dx$photo, dx$chill))#
nl3$prop <- nl3$Freq/dl3$Freq#
nl3$prop[is.nan(nl3$prop)==TRUE] <- 0#
names(nl1) <- c("sp","site","freq")#
names(nl2) <- c("warm","photo","chill","freq", "prop")#
names(nl3) <- c("sp", "site", "warm","photo","chill","freq", "prop")#
#
nl3.nochill <- subset(nl3, chill=="chill0")#
nl3.1chill <- subset(nl3, chill=="chill1")#
nl3.2chill <- subset(nl3, chill=="chill2")#
#
# make some simple plots#
makesimpleplot(nl3, c(0, 0.4), "prop", "% non-leafout") # all chilling combined#
makesimpleplot(nl3.nochill, c(0, 0.4), "prop", "% non-leafout")#
makesimpleplot(nl3.1chill, c(0, 0.4), "prop", "% non-leafout")#
makesimpleplot(nl3.2chill, c(0, 0.4), "prop", "% non-leafout")#
#
sitespp <- as.data.frame(table(nl3$sp, nl3$site))#
sitespp <- subset(sitespp, Freq>0)#
sppatsites <- aggregate(sitespp["Var2"], sitespp["Var1"], FUN=length)#
sppatbothsites <- subset(sppatsites, Var2>1)#
#
spp <- sppatbothsites$Var1#
pdf(file="graphs/simpleplots/nonleafouts_byspp.pdf", 10, 6, paper="a4r", onefile=TRUE)#
for (i in c(1:length(spp))){#
    spdf <- subset(nl3.nochill, sp==spp[i])#
    makesimpleplot.sp(spdf, c(0, 1), "prop", "% non-leafout", spp[i])#
}#
dev.off()#
# <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <>#
# Simple models by species. All predictors now numeric
# Where were the non-leafout cuttings, by species, site, and treatement?#
library(scales)#
library(gplots) # for textplot()#
#
setwd("~/Documents/git/buds/analyses") # setwd("~/Documents/git/projects/treegarden/budburstexp2015/analyses")#
#
# get latest data#
print(toload <- sort(dir("./input")[grep("Budburst Data", dir('./input'))], T)[1])#
#
load(file.path("input", toload))#
#
source("source/simpleplot.R")#
#
dx <- dx[!is.na(dx$site),] # one Betpap entry has no site, need to check#
#
# Analysis of where the non-leafout cuttings were#
nlx <- dx[dx$nl == 0,]#
#
summary(nlx)#
#
nl1 <- as.data.frame(table(nlx$sp, nlx$site))#
#
nl2 <- as.data.frame(table(nlx$warm, nlx$photo, nlx$chill))#
# proportional to total numbers in each#
dl2 <- as.data.frame(table(dx$warm, dx$photo, dx$chill))#
nl2$prop <- nl2$Freq/dl2$Freq#
nl3 <- as.data.frame(table(nlx$sp, nlx$site,nlx$warm, nlx$photo, nlx$chill))#
dl3 <- as.data.frame(table(dx$sp, dx$site, dx$warm, dx$photo, dx$chill))#
nl3$prop <- nl3$Freq/dl3$Freq#
nl3$prop[is.nan(nl3$prop)==TRUE] <- 0#
names(nl1) <- c("sp","site","freq")#
names(nl2) <- c("warm","photo","chill","freq", "prop")#
names(nl3) <- c("sp", "site", "warm","photo","chill","freq", "prop")#
#
nl3.nochill <- subset(nl3, chill=="chill0")#
nl3.1chill <- subset(nl3, chill=="chill1")#
nl3.2chill <- subset(nl3, chill=="chill2")#
#
# make some simple plots#
# # makesimpleplot(nl3, c(0, 0.4), "prop", "% non-leafout") # all chilling combined#
# makesimpleplot(nl3.nochill, c(0, 0.4), "prop", "% non-leafout")#
# makesimpleplot(nl3.1chill, c(0, 0.4), "prop", "% non-leafout")#
# makesimpleplot(nl3.2chill, c(0, 0.4), "prop", "% non-leafout")#
#
sitespp <- as.data.frame(table(nl3$sp, nl3$site))#
sitespp <- subset(sitespp, Freq>0)#
sppatsites <- aggregate(sitespp["Var2"], sitespp["Var1"], FUN=length)#
sppatbothsites <- subset(sppatsites, Var2>1)#
#
spp <- sppatbothsites$Var1#
pdf(file="graphs/simpleplots/nonleafouts_byspp.pdf", 10, 6, paper="a4r", onefile=TRUE)#
for (i in c(1:length(spp))){#
    spdf <- subset(nl3.nochill, sp==spp[i])#
    makesimpleplot.sp(spdf, c(0, 1), "prop", "% non-leafout", spp[i])#
}#
dev.off()#
# <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <>#
# Simple models by species. All predictors now numeric#
#
dx$chill <- as.numeric(dx$chill)#
dx$site <- as.numeric(dx$site)#
dx$photo <- as.numeric(as.character(dx$photo))#
dx$warm <- as.numeric(as.character(dx$warm))
# Where were the non-leafout cuttings, by species, site, and treatement?#
library(scales)#
library(gplots) # for textplot()#
#
setwd("~/Documents/git/buds/analyses") # setwd("~/Documents/git/projects/treegarden/budburstexp2015/analyses")#
#
# get latest data#
print(toload <- sort(dir("./input")[grep("Budburst Data", dir('./input'))], T)[1])#
#
load(file.path("input", toload))#
#
source("source/simpleplot.R")#
#
dx <- dx[!is.na(dx$site),] # one Betpap entry has no site, need to check#
#
# Analysis of where the non-leafout cuttings were#
nlx <- dx[dx$nl == 0,]#
#
summary(nlx)#
#
nl1 <- as.data.frame(table(nlx$sp, nlx$site))#
#
nl2 <- as.data.frame(table(nlx$warm, nlx$photo, nlx$chill))#
# proportional to total numbers in each#
dl2 <- as.data.frame(table(dx$warm, dx$photo, dx$chill))#
nl2$prop <- nl2$Freq/dl2$Freq#
nl3 <- as.data.frame(table(nlx$sp, nlx$site,nlx$warm, nlx$photo, nlx$chill))#
dl3 <- as.data.frame(table(dx$sp, dx$site, dx$warm, dx$photo, dx$chill))#
nl3$prop <- nl3$Freq/dl3$Freq#
nl3$prop[is.nan(nl3$prop)==TRUE] <- 0#
names(nl1) <- c("sp","site","freq")#
names(nl2) <- c("warm","photo","chill","freq", "prop")#
names(nl3) <- c("sp", "site", "warm","photo","chill","freq", "prop")#
#
nl3.nochill <- subset(nl3, chill=="chill0")#
nl3.1chill <- subset(nl3, chill=="chill1")#
nl3.2chill <- subset(nl3, chill=="chill2")#
#
# make some simple plots#
# # makesimpleplot(nl3, c(0, 0.4), "prop", "% non-leafout") # all chilling combined#
# makesimpleplot(nl3.nochill, c(0, 0.4), "prop", "% non-leafout")#
# makesimpleplot(nl3.1chill, c(0, 0.4), "prop", "% non-leafout")#
# makesimpleplot(nl3.2chill, c(0, 0.4), "prop", "% non-leafout")#
#
sitespp <- as.data.frame(table(nl3$sp, nl3$site))#
sitespp <- subset(sitespp, Freq>0)#
sppatsites <- aggregate(sitespp["Var2"], sitespp["Var1"], FUN=length)#
sppatbothsites <- subset(sppatsites, Var2>1)#
#
spp <- sppatbothsites$Var1#
pdf(file="graphs/simpleplots/nonleafouts_byspp.pdf", 10, 6, paper="a4r", onefile=TRUE)#
for (i in c(1:length(spp))){#
    spdf <- subset(nl3.nochill, sp==spp[i])#
    makesimpleplot.sp(spdf, c(0, 1), "prop", "% non-leafout", spp[i])#
}#
dev.off()#
# <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <>#
# Simple models by species. All predictors now numeric
dx$photo
as.numeric(dx$photo)
dx$chill <- as.numeric(dx$chill)#
dx$site <- as.numeric(dx$site)#
dx$photo <- as.numeric(dx$photo)#
dx$warm <- as.numeric(dx$warm)
dx$warm
dx$site
pdf(file="graphs/simpleplots/nonleafouts_byspp_model.pdf", height = 10, width = 10)#
#
par(cex=0.7, xpd=TRUE, xaxt="n")#
layout(matrix(c(1, 2, 3, 3), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
#
	makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)#
#
	# is this species across site and chill?#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) > 1)  {#
			mx <- glm(nl ~ warm + photo + chill + site #
							+ warm:photo + warm:chill + warm:site #
							+ photo:chill + photo:site#
							+ warm:photo:chill#
							+ warm:photo:site #
							+ warm:chill:site #
							+ photo:chill:site#
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
#
			} #
	# Across site but no chill?		#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1)  {#
			mx <- glm(nl ~ warm + photo + site #
							+ warm:photo +  warm:site + photo:site#
							+ warm:photo:site #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
			} #
	# One site, no chill?		#
	if(length(unique(dx[dx$sp ==i,"site"])) == 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1)  {#
		mx <- glm(nl ~ warm + photo +  #
							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
			} #
	textplot(round(coef(summary(mx)),3))#
		}#
dev.off(); system('open graphs/simpleplots/nonleafouts_byspp_model.pdf -a /Applications/Preview.app')
pdf(file="graphs/simpleplots/nonleafouts_byspp_model.pdf", height = 10, width = 10)#
#
par(cex=0.7, xpd=TRUE, xaxt="n")#
layout(matrix(c(1, 2, 3, 3), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
#
	makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)#
#
	# is this species across site and chill?#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) > 1)  {#
			mx <- glm(nl ~ warm + photo + chill + site #
							+ warm:photo + warm:chill + warm:site #
							+ photo:chill + photo:site#
							+ warm:photo:chill#
							+ warm:photo:site #
							+ warm:chill:site #
							+ photo:chill:site#
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
#
			} #
	# Across site but no chill?		#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1)  {#
			mx <- glm(nl ~ warm + photo + site #
							+ warm:photo +  warm:site + photo:site#
							+ warm:photo:site #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
			} #
	# One site, no chill?		#
	if(length(unique(dx[dx$sp ==i,"site"])) == 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1)  {#
		mx <- glm(nl ~ warm + photo +  #
							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
			} #
	textplot(round(coef(summary(mx)),3))#
		}#
dev.off(); system('open graphs/simpleplots/nonleafouts_byspp_model.pdf -a /Applications/Preview.app')#
#
# examination code
# Where were the non-leafout cuttings, by species, site, and treatement?#
library(scales)#
library(gplots) # for textplot()#
#
setwd("~/Documents/git/buds/analyses") # setwd("~/Documents/git/projects/treegarden/budburstexp2015/analyses")#
#
# get latest data#
print(toload <- sort(dir("./input")[grep("Budburst Data", dir('./input'))], T)[1])#
#
load(file.path("input", toload))#
#
source("source/simpleplot.R")#
#
dx <- dx[!is.na(dx$site),] # one Betpap entry has no site, need to check
dx$site
# Where were the non-leafout cuttings, by species, site, and treatement?#
library(scales)#
library(gplots) # for textplot()#
#
setwd("~/Documents/git/buds/analyses") # setwd("~/Documents/git/projects/treegarden/budburstexp2015/analyses")#
#
# get latest data#
print(toload <- sort(dir("./input")[grep("Budburst Data", dir('./input'))], T)[1])#
#
load(file.path("input", toload))#
#
source("source/simpleplot.R")#
#
dx <- dx[!is.na(dx$site),] # one Betpap entry has no site, need to check#
#
# Analysis of where the non-leafout cuttings were#
nlx <- dx[dx$nl == 0,]#
#
summary(nlx)#
#
nl1 <- as.data.frame(table(nlx$sp, nlx$site))#
#
nl2 <- as.data.frame(table(nlx$warm, nlx$photo, nlx$chill))#
# proportional to total numbers in each#
dl2 <- as.data.frame(table(dx$warm, dx$photo, dx$chill))#
nl2$prop <- nl2$Freq/dl2$Freq#
nl3 <- as.data.frame(table(nlx$sp, nlx$site,nlx$warm, nlx$photo, nlx$chill))#
dl3 <- as.data.frame(table(dx$sp, dx$site, dx$warm, dx$photo, dx$chill))#
nl3$prop <- nl3$Freq/dl3$Freq#
nl3$prop[is.nan(nl3$prop)==TRUE] <- 0#
names(nl1) <- c("sp","site","freq")#
names(nl2) <- c("warm","photo","chill","freq", "prop")#
names(nl3) <- c("sp", "site", "warm","photo","chill","freq", "prop")#
#
nl3.nochill <- subset(nl3, chill=="chill0")#
nl3.1chill <- subset(nl3, chill=="chill1")#
nl3.2chill <- subset(nl3, chill=="chill2")#
#
# make some simple plots#
# # makesimpleplot(nl3, c(0, 0.4), "prop", "% non-leafout") # all chilling combined#
# makesimpleplot(nl3.nochill, c(0, 0.4), "prop", "% non-leafout")#
# makesimpleplot(nl3.1chill, c(0, 0.4), "prop", "% non-leafout")#
# makesimpleplot(nl3.2chill, c(0, 0.4), "prop", "% non-leafout")#
#
sitespp <- as.data.frame(table(nl3$sp, nl3$site))#
sitespp <- subset(sitespp, Freq>0)#
sppatsites <- aggregate(sitespp["Var2"], sitespp["Var1"], FUN=length)#
sppatbothsites <- subset(sppatsites, Var2>1)#
#
spp <- sppatbothsites$Var1#
pdf(file="graphs/simpleplots/nonleafouts_byspp.pdf", 10, 6, paper="a4r", onefile=TRUE)#
for (i in c(1:length(spp))){#
    spdf <- subset(nl3.nochill, sp==spp[i])#
    makesimpleplot.sp(spdf, c(0, 1), "prop", "% non-leafout", spp[i])#
}#
dev.off()#
# <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <>#
# Simple models by species. All predictors now numeric#
#
# # dx$chill <- as.numeric(dx$chill)#
# dx$site <- as.numeric(dx$site)#
# dx$photo <- as.numeric(dx$photo)#
# dx$warm <- as.numeric(dx$warm)
pdf(file="graphs/simpleplots/nonleafouts_byspp_model.pdf", height = 10, width = 10)#
#
par(cex=0.7, xpd=TRUE, xaxt="n")#
layout(matrix(c(1, 2, 3, 3), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
#
	makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)#
#
	# is this species across site and chill?#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) > 1)  {#
			mx <- glm(nl ~ warm + photo + chill + site #
							+ warm:photo + warm:chill + warm:site #
							+ photo:chill + photo:site#
							+ warm:photo:chill#
							+ warm:photo:site #
							+ warm:chill:site #
							+ photo:chill:site#
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
#
			} #
	# Across site but no chill?		#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1)  {#
			mx <- glm(nl ~ warm + photo + site #
							+ warm:photo +  warm:site + photo:site#
							+ warm:photo:site #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
			} #
	# One site, no chill?		#
	if(length(unique(dx[dx$sp ==i,"site"])) == 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1)  {#
		mx <- glm(nl ~ warm + photo +  #
							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
			} #
	textplot(round(coef(summary(mx)),3))#
		}#
dev.off(); system('open graphs/simpleplots/nonleafouts_byspp_model.pdf -a /Applications/Preview.app')
dx$chill <- as.numeric(dx$chill)#
dx$site <- as.numeric(dx$site)#
dx$photo <- as.numeric(dx$photo)#
dx$warm <- as.numeric(dx$warm)#
#
pdf(file="graphs/simpleplots/nonleafouts_byspp_model.pdf", height = 10, width = 10)#
#
par(cex=0.7, xpd=TRUE, xaxt="n")#
layout(matrix(c(1, 2, 3, 3), byrow=T, ncol = 2, nrow = 2), heights = c(3, 2))#
for(i in sort(unique(dx$sp))){#
#
	makesimpleplot.sp(nl3[nl3$sp ==i,], c(0, 1), "prop", "% non-leafout", i)#
#
	# is this species across site and chill?#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) > 1)  {#
			mx <- glm(nl ~ warm + photo + chill + site #
							+ warm:photo + warm:chill + warm:site #
							+ photo:chill + photo:site#
							+ warm:photo:chill#
							+ warm:photo:site #
							+ warm:chill:site #
							+ photo:chill:site#
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
#
			} #
	# Across site but no chill?		#
	if(length(unique(dx[dx$sp ==i,"site"])) > 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1)  {#
			mx <- glm(nl ~ warm + photo + site #
							+ warm:photo +  warm:site + photo:site#
							+ warm:photo:site #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
			} #
	# One site, no chill?		#
	if(length(unique(dx[dx$sp ==i,"site"])) == 1 & length(unique(dx[dx$sp ==i,"chill"])) == 1)  {#
		mx <- glm(nl ~ warm + photo +  #
							+ warm:photo #
							, family=binomial(link='logit'), data = dx[dx$sp == i,]#
							)#
			} #
	textplot(round(coef(summary(mx)),3))#
		}#
dev.off(); system('open graphs/simpleplots/nonleafouts_byspp_model.pdf -a /Applications/Preview.app')
i="ACESAC"
with(dx[dx$sp == i,], tapply(nl, list(warm, photo, site, chill), mean))
with(dx[dx$sp == i,], tapply(nl, list(warm, site, chill), mean))
with(dx[dx$sp == i,], tapply(nl, list(warm, chill, site), mean))
dx$warm <- as.numeric(as.character(dx$warm))#
dx$photo <- as.numeric(as.character(dx$photo))
l1 <- lm(lday ~ warm + photo + chill + site #
							+ warm:photo + warm:chill + warm:site #
							+ photo:chill + photo:site#
							+ warm:photo:chill#
							+ warm:photo:site #
							+ warm:chill:site #
							+ photo:chill:site#
							data = dx[dx$nl==1,]#
							)
l1 <- lm(lday ~ warm + photo + chill + site #
							+ warm:photo + warm:chill + warm:site #
							+ photo:chill + photo:site#
							+ warm:photo:chill#
							+ warm:photo:site #
							+ warm:chill:site #
							+ photo:chill:site#
							, data = dx[dx$nl==1,]#
							)#
	summary(l1)
summary.aov(l1)
l2 <- lmer(lday ~ warm + photo + chill + site #
							+ warm:photo + warm:chill + warm:site #
							+ photo:chill + photo:site#
							+ warm:photo:chill#
							+ warm:photo:site #
							+ warm:chill:site #
							+ photo:chill:site#
							+ (1|sp)#
							, data = dx[dx$nl==1,]#
							)#
	summary(l2)
sjp(l2)
sjp.lmer(l2)
sjp.lmer(l2, type = "fe")
xx <- dx[dx$sp==i,]#
		means <- with(xx, tapply(lday, list(warm, photo, site), mean, na.rm=T))#
		sds <- with(xx, tapply(lday, list(warm, photo, site), sd, na.rm=T))
xx
means <- with(xx, tapply(lday, list(warm, photo, site), mean, na.rm=T))
means
sds
summary(l2)
source('savestan.R')
# Analysis of budburst experiment. Starting with simple linear models#
# 2015-09-16 adding single species models#
#
library(nlme)#
library(scales)#
library(arm)#
library(rstan)#
#
setwd("~/Documents/git/buds/analyses")#
source('savestan.R')
print(toload <- sort(dir("./input")[grep("Budburst Data", dir('./input'))], T)[1])#
#
load(file.path("input", toload))
# Analysis of budburst experiment. Starting with simple linear models#
# 2015-09-16 adding single species models#
#
library(nlme)#
library(scales)#
library(arm)#
library(rstan)#
#
setwd("~/Documents/git/buds/analyses")#
source('savestan.R')#
# get latest data#
print(toload <- sort(dir("./input")[grep("Budburst Data", dir('./input'))], T)[1])#
#
load(file.path("input", toload))#
#
dx <- dx[!is.na(dx$site),] # one Betpap entry has no site, need to check#
#
# Anovas based on day to leafout (stage 6)#
#
summary(m1 <- aov(lday ~ sp * site + warm * photo + Error(ind), data = dx[dx$chill == 'chill0',]))#
#
# Comparing Type I SS issues#
summary(m1 <- aov(lday ~ site * warm * photo + Error(ind), data = dx[dx$chill == 'chill0',]))#
summary(m1 <- aov(lday ~ warm * photo * site + Error(ind), data = dx[dx$chill == 'chill0',]))#
summary(m1 <- aov(lday ~ warm * site  * photo + Error(ind), data = dx[dx$chill == 'chill0',]))#
#
summary(m2 <- aov(lday ~ sp * site * warm * photo + Error(ind), data = dx[dx$chill == 'chill0',])) # interax with sp and warm, also sp and photo, no site effects!#
#
summary(bm2 <- aov(bday ~ sp * site * warm * photo + Error(ind), data = dx[dx$chill == 'chill0',])) # site effects interax with warm for budbust (stage 3) but not leafout (stage 6)#
#
summary(fm2 <- aov(fday ~ sp * site * warm * photo + Error(ind), data = dx[dx$chill == 'chill0',])) # no clear effects of anything other than species for the flowering#
#
# with lme4 mixed effect model to better take into account species differences #
#
# test without the nonleafouts -- these did no ever leaf out, or flower, over the course of the experiment, but were not dead. Previously had '75' days was assigned to them as max value#
#
m3 <- lmer(lday ~ warm * photo * site  + (warm|sp) + (photo|sp), data = dx[dx$chill == 'chill0' & dx$nl == 1,]) # NAs in lday being omitted, doesn't matter if specify nl == 1 or not.#
summary(m3)#
fixef(m3)#
ranef(m3)#
# What if we try this with moving the species to fixed effects? Trying this talking to Lizzie Oct 1#
summary(m22 <- aov(lday ~ sp * site * as.numeric(warm) * as.numeric(photo) + Error(ind), data = dx[dx$chill == 'chill0',])) # #
coef(m22)#
#
# <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <> <>#
#
# New analyses, in stan, using simple models#
# model 1: lday ~ warm * photo, no species, site, or ind.#
# make data all numeric.#
levels(dx$warm) = c(0,1); levels(dx$photo) = c(0, 1); levels(dx$site) = 1:2; levels(dx$sp) = 1:length(levels(dx$sp))#
dx$warm <- as.numeric(dx$warm)#
dx$photo <- as.numeric(dx$photo)#
dx$site <- as.numeric(dx$site)#
dx$sp <- as.numeric(dx$sp)#
#
# Make sure no NA's (nonleafouts)#
dx <- dx[!is.na(dx$lday),]#
#
datalist1 <- list(lday = dx$lday, warm = dx$warm, photo = dx$photo, N = nrow(dx))#
#
doym1 <- stan('doy_model1.stan', data = datalist1, iter = 1000, chains = 4)#
#
# Model 2: site added#
datalist2 <- list(lday = dx$lday, warm = dx$warm, site = dx$site, photo = dx$photo, N = nrow(dx), n_site = length(unique(dx$site)))#
#
doym2 <- stan('doy_model2.stan', data = datalist2, iter = 1000, chains = 4)#
#
head(summary(doym2)$summary) # leafout day slightly later for HF#
#
# doym3  -- need to make a sp_site vector#
sp_site = as.numeric(paste(dx$site, formatC(dx$sp, width = 2, flag = '0'), sep=""))#
sp_sitef = factor(sp_site)#
levels(sp_sitef) = 1:length(levels(sp_sitef))#
sp_site = as.numeric(sp_sitef)#
#
datalist3 <- list(lday = dx$lday, warm = dx$warm, site = dx$site, sp = dx$sp, photo = dx$photo, N = nrow(dx), n_site = length(unique(dx$site)), n_sp = length(unique(dx$sp)), sp_site = sp_site, n_sp_site = length(unique(sp_site)))#
#
doym3 <- stan('doy_model3.stan', data = datalist3, iter = 1000, chains = 4) #
#
summary(doym3)$summary[1:50,] # no site effect now.#
savestan()
